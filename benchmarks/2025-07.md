# AnyCable for Laravel benchmarks

## Broadcast latency

The benchmarks were performed with [k6](https://k6.io/). See the `benchmark.js` file for the scenario.

"Hardware": MacBook Pro M1, 28GB RAM, Docker (via OrbStack).

### AnyCable

Server command:

```sh
docker run --rm \
  --network host \
  -e "ANYCABLE_PORT=6001" \
  -e "ANYCABLE_PUSHER_APP_KEY=app-key" \
  -e "ANYCABLE_PUSHER_APP_ID=app-id" \
  -e "ANYCABLE_PUSHER_SECRET=app-secret" \
  -e "ANYCABLE_BROADCAST_ADAPTER=http" \
  anycable/anycable-go:c2e725b
```

Benchmark command:

```sh
k6 run -e MAX_VUS=1000 -e TIME=120 benchmark.js
```

Results:

```sh
✗ ws connected
  ↳  96% — ✓ 1671 / ✗ 68
✓ subscribed

CUSTOM
broadcast_latency..........................: avg=1.74s    min=0s       med=283ms   max=1m37s  p(90)=4.17s   p(95)=9.56s
connection_errors..........................: 68      0.289328/s
events_received............................: 9816228 41766.278196/s
events_sent................................: 19069   81.135153/s
handshake_latency..........................: avg=698.18ms min=0s       med=53ms    max=15.14s p(90)=1.12s   p(95)=4.04s
subscription_latency.......................: avg=571.93ms min=0s       med=12ms    max=30.47s p(90)=266.1ms p(95)=3.39s

EXECUTION
iteration_duration.........................: avg=46.65s   min=6.03s    med=46.8s   max=2m37s  p(90)=49.86s  p(95)=52.82s
iterations.................................: 1739    7.399131/s
vus........................................: 1       min=1          max=1000
vus_max....................................: 1000    min=1000       max=1000

NETWORK
data_received..............................: 1.6 GB  6.8 MB/s
data_sent..................................: 3.8 MB  16 kB/s

WEBSOCKET
ws_connecting..............................: avg=1.18s    min=407.62µs med=34.67ms max=30.03s p(90)=3.05s   p(95)=7.03s
ws_msgs_received...........................: 9819563 41780.468019/s
ws_msgs_sent...............................: 22411   95.35476/s
ws_session_duration........................: avg=46.75s   min=45s      med=45.43s  max=2m35s  p(90)=49.03s  p(95)=52.05s
ws_sessions................................: 1739    7.399131/s
```

Memory usage (peak): ~80Mib.

### Soketi

Server command:

```sh
docker run --rm \
  --network host \
  -e "SOKETI_DEFAULT_APP_ENABLE_CLIENT_MESSAGES=true" \
  quay.io/soketi/soketi:1.4-16-debian
```

Benchmark command:

```sh
k6 run -e MAX_VUS=1000 -e TIME=120 benchmark.js
```

Results:

```sh
✗ ws connected
  ↳  92% — ✓ 1555 / ✗ 118
✓ subscribed

CUSTOM
broadcast_latency..........................: avg=5.17s  min=0s       med=1.13s    max=1m42s  p(90)=16.33s p(95)=25.32s
connection_errors..........................: 118     0.571499/s
events_received............................: 9314184 45110.567114/s
events_sent................................: 22241   107.717877/s
handshake_latency..........................: avg=1.95s  min=0s       med=206ms    max=29.36s p(90)=6.26s  p(95)=11.56s
subscription_latency.......................: avg=1.53s  min=0s       med=27ms     max=35.98s p(90)=4.5s   p(95)=9.53s

EXECUTION
iteration_duration.........................: avg=50.97s min=10.44s   med=48.21s   max=2m9s   p(90)=1m2s   p(95)=1m16s
iterations.................................: 1664    8.059105/s
vus........................................: 1       min=1          max=1000
vus_max....................................: 1000    min=1000       max=1000

NETWORK
data_received..............................: 1.7 GB  8.0 MB/s
data_sent..................................: 4.3 MB  21 kB/s

WEBSOCKET
ws_connecting..............................: avg=3.3s   min=483.41µs med=236.44ms max=57.62s p(90)=12.19s p(95)=18.64s
ws_msgs_received...........................: 9317256 45125.445461/s
ws_msgs_sent...............................: 25351   122.780266/s
ws_session_duration........................: avg=51.64s min=45s      med=47.37s   max=2m7s   p(90)=1m2s   p(95)=1m15s
ws_sessions................................: 1664    8.059105/s
```

Memory usage (peak): ~107Mib.

### Reverb

Server command:

```sh
docker run --rm \
  --network host \
  larachat-reverb
```

Benchmark command:

```sh
k6 run -e MAX_VUS=1000 -e TIME=120 -e WS_PORT=8080 benchmark.js
```

Results:

```sh
✓ ws connected
✓ subscribed

CUSTOM
broadcast_latency..........................: avg=297.02ms min=1ms      med=130ms   max=14.74s p(90)=698ms    p(95)=1.04s
connection_errors..........................: 0        0/s
events_received............................: 12256335 73572.198854/s
events_sent................................: 20813    124.936058/s
handshake_latency..........................: avg=179.79ms min=1ms      med=56ms    max=12.05s p(90)=271.4ms  p(95)=1.02s
subscription_latency.......................: avg=50.06ms  min=0s       med=22ms    max=3.43s  p(90)=96.7ms   p(95)=145.69ms

EXECUTION
iteration_duration.........................: avg=46.58s   min=45.4s    med=46.51s  max=1m1s   p(90)=47.34s   p(95)=47.81s
iterations.................................: 1714     10.288781/s
vus........................................: 1        min=1          max=1000
vus_max....................................: 1000     min=1000       max=1000

NETWORK
data_received..............................: 1.8 GB   11 MB/s
data_sent..................................: 3.8 MB   23 kB/s

WEBSOCKET
ws_connecting..............................: avg=163.07ms min=608.29µs med=38.19ms max=12.03s p(90)=243.69ms p(95)=1.01s
ws_msgs_received...........................: 12259763 73592.776416/s
ws_msgs_sent...............................: 24241    145.51362/s
ws_session_duration........................: avg=45.39s   min=45s      med=45.16s  max=59.5s  p(90)=46.03s   p(95)=46.25s
ws_sessions................................: 1714     10.288781/s
```

Memory usage (peak): ~85Mib.

## Connection avalanche

The benchmarks were performed via the [websocket-bench](https://github.com/anycable/websocket-bench) tool.

"Hardware": MacBook Pro M1, 28GB RAM, Docker (via OrbStack).

The benchmark measures the resources usage and connection time in case when tons of clients (in our case 20k) try to connect at the same time.

The benchmark command is as follows:

```sh
websocket-bench connect <url> \
  --concurrent 2000 \
  --step-size 10000 \
  --total-steps 2 \
  --server-type=<server-type>
```

We repeat it 5 times (with a short delay, 2-3s) and take the worst result (in terms of connection latency) and the peak memory usage.

**NOTE:** By "connection" we mean a successfully initialized client with a channel subscription (this, it's not a WebSocket connection, but also a channel subscription).

### AnyCable

Server command:

```sh
docker run --rm \
  --network host \
  -e "ANYCABLE_PUSHER_APP_KEY=app-key" \
  -e "ANYCABLE_PUSHER_APP_ID=app-id" \
  -e "ANYCABLE_PUBLIC=true" \
  -e "ANYCABLE_BROADCAST_ADAPTER=http" \
  anycable/anycable-go:1.6
```

Benchmark command:

```sh
websocket-bench connect \
  "ws://127.0.0.1:8080/app/app-key?client=js&version=7.0.3&protocol=7" \
  --server-type anycable-connect \
  --concurrent 2000 --step-size 10000 --total-steps 2
```

Results:

```sh
[2025-07-12T21:07:09-07:00] clients: 10000    95per-rtt:  34ms    min-rtt:  20ms    median-rtt:  29ms    max-rtt:  53ms
[2025-07-12T21:07:09-07:00] clients: 10000    95per-rtt:  53ms    min-rtt:  34ms    median-rtt:  49ms    max-rtt:  58ms
```

Memory usage (idle -> peak -> post-benchmark): ~38MiB -> ~55MiB -> ~24MiB.


### Soketi

Server command:

```sh
docker run --rm \
  --network host \
  quay.io/soketi/soketi:1.4-16-debian
```

Benchmark command:

```sh
websocket-bench connect \
  "ws://127.0.0.1:6001/app/app-key?client=js&version=7.0.3&protocol=7" \
  --server-type pusher-connect \
  --concurrent 2000 --step-size 10000 --total-steps 2
```

Results:

```sh
[2025-07-12T21:11:55-07:00] clients: 10000    95per-rtt:  42ms    min-rtt:  29ms    median-rtt:  36ms    max-rtt:  44ms
[2025-07-12T21:11:55-07:00] clients: 10000    95per-rtt:  74ms    min-rtt:  42ms    median-rtt:  71ms    max-rtt:  76ms
```

Memory usage (idle -> peak -> post-benchmark): ~95Mib -> ~145MiB -> ~73MiB.

### Reverb

Server command:

```sh
docker run --rm \
  --network host \
  laravel-reverb-app
```

(This is our [demo application's](https://github.com/anycable/laravel-anycable-demo) Docker image).

Benchmark command:

```sh
websocket-bench connect \
  "ws://127.0.0.1:8080/app/app-key?client=js&version=7.0.3&protocol=7" \
  --server-type pusher-connect \
  --concurrent 2000 --step-size 10000 --total-steps 2
```

Results:

```sh
[2025-07-12T21:09:13-07:00] clients: 10000    95per-rtt:  53ms    min-rtt:  45ms    median-rtt:  50ms    max-rtt:  54ms
[2025-07-12T21:09:13-07:00] clients: 10000    95per-rtt:  97ms    min-rtt:  54ms    median-rtt:  92ms    max-rtt:  97ms
```

Memory usage (idle -> peak -> post-benchmark): ~83Mib -> ~100MiB -> ~71MiB.
